from requests import Request, Session
import requests
import json
import pprint



BITCOIN_API_URL= 'https://pro-api.coinmarketcap.com/v1/cryptocurrency/quotes/latest'
IFTTT_WEBHOOK_URL = 'https://maker.ifttt.com/trigger/<event>/json/with/key/<key>'
global event
event = 'bitcoin_price_update'

def getInfo (): # Function to get the info

    parameters = { 'slug': 'bitcoin', 'convert': 'USD' } # API parameters to pass in for retrieving specific cryptocurrency data

    headers = {
        'Accepts': 'application/json',
        'X-CMC_PRO_API_KEY': '<key>'
    } # Replace 'YOUR_API_KEY' with the API key you have received in the previous step

    session = Session()
    session.headers.update(headers)

    response = session.get(BITCOIN_API_URL, params=parameters)

    global btcPrice

    btcPrice = json.loads(response.text)['data']['1']['quote']['USD']['price']

    btcPrice = round(btcPrice, 2)
    btcPrice = float((f'{btcPrice:.2f}'))
    global value
    value = btcPrice
    pprint.pprint(btcPrice)

def post_ifttt_webhook(event, value):
    # The payload that will be sent to IFTTT service
    data = {btcPrice: value}
    # inserts our desired event
    ifttt_event_url = IFTTT_WEBHOOK_URL.format(event)
    # Sends a HTTP POST request to the webhook URL
    requests.post(ifttt_event_url, json=data)

        
getInfo() # Calling the function to get the statistics
#requests.post(IFTTT_WEBHOOK_URL)
post_ifttt_webhook(event, btcPrice) # Calling the function to send info to Discord
